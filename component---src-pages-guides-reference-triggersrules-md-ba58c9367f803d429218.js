(self.webpackChunkdev_site_documentation_template=self.webpackChunkdev_site_documentation_template||[]).push([[6020],{30376:function(e,a,t){"use strict";t.r(a),t.d(a,{_frontmatter:function(){return s},default:function(){return u}});var n=t(22122),i=t(19756),r=(t(15007),t(64983)),o=t(99536),l=["components"],s={},d={_frontmatter:s},m=o.Z;function u(e){var a=e.components,t=(0,i.Z)(e,l);return(0,r.mdx)(m,(0,n.Z)({},d,t,{components:a,mdxType:"MDXLayout"}),(0,r.mdx)("h1",{id:"using-triggers-and-rules"},"Using Triggers and Rules"),(0,r.mdx)("p",null,"Invoking an action directly in the CLI is quite limited; what you want to do is configure Adobe I/O Runtime to respond to events. The Runtime features that enable you to do this are triggers and rules:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("em",{parentName:"li"},"Triggers")," are events: each trigger you create represents a particular class of event."),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("em",{parentName:"li"},"Rules")," are associations between triggers and actions. Rules are the way you make Runtime execute code in response to an event.")),(0,r.mdx)("h2",{id:"about-triggers"},"About triggers"),(0,r.mdx)("p",null,"Triggers are a way for you to apply a name to a class of events. Some examples:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},"updating a user","’","s location on a mobile app"),(0,r.mdx)("li",{parentName:"ul"},"uploading a file to cloud storage"),(0,r.mdx)("li",{parentName:"ul"},"sending an email or text message")),(0,r.mdx)("p",null,"Almost anything can be classified as an event by defining it as a trigger. In Runtime, events are defined by means of a set of key-value pairs; this allows them to be passed to an action as a JSON object. Triggers are used to define the keys for these pairs. When a trigger is activated (",(0,r.mdx)("em",{parentName:"p"},"fired"),"), it reads from the event source the values for these keys and passes on a dictionary of key-value pairs that define the event."),(0,r.mdx)("p",null,"You can fire a trigger explicitly in the CLI yourself, but it","’","s much more common for an event source to be configured to fire triggers via a feed. For more information, see ",(0,r.mdx)("a",{parentName:"p",href:"feeds.md",title:"Using feeds"},"Using Feeds"),"."),(0,r.mdx)("h2",{id:"about-rules"},"About rules"),(0,r.mdx)("p",null,"Rules link triggers with actions. Each rule links a specific trigger with a single action: every time the trigger is fired, the rule causes the action to be invoked with the trigger","’","s event used as input parameters. By combining rules, however, you can cause a trigger to fire multiple actions, or cause a action to respond to multiple triggers. "),(0,r.mdx)("p",null,"For example, consider a mobile app that tracks the user","’","s location when the user takes a photo, records the user","’","s GPS coordinates, and uploads the photo to the user","’","s Adobe Assetsa account, in a library named ","“","My Photos","”",". The app also captures images sent or received via text or email and uploads them to the user","’","s Adobe Assets, in another library named ","“","Shared with Me","”",". You could configure the following actions:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"catalogImg"),": calls a Sensei Studio function to analyze the image and recognize objects"),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"mapImg"),": adds metadata to the image to log its GPS coordinates"),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"thumbImg"),": creates a thumbnail of an image")),(0,r.mdx)("p",null,"Using the mobile app as an event source, you could set the following triggers:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"myPhoto"),": fires when the app uploads a photo taken by the user"),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"sharedImg"),": fires when the app uploads an image sent or received via email or text message")),(0,r.mdx)("p",null,"To process these images in Runtime, you could set the following rules:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"myPhoto -> catalogImg")),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"myPhoto -> mapImg")),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"myPhoto -> thumbImg")),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"sharedImg -> catalogImg")),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"sharedImg -> thumbImg"))),(0,r.mdx)("p",null,"So, with these rules, both images taken by the user and images sent or received via email or text are catalogued and thumbnails are created; for the user","’","s own images only, GPS coordinates are tracked."),(0,r.mdx)("h2",{id:"creating-and-firing-triggers"},"Creating and firing triggers"),(0,r.mdx)("p",null,"Creating triggers is easy. Consider a trigger to update a user","’","s location; every time the trigger is fired, it sends the user","’","s name and GPS coordinates. To create the trigger in the CLI:"),(0,r.mdx)("p",null,(0,r.mdx)("inlineCode",{parentName:"p"},"wsk trigger create updateLoc")),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre"},"ok: created trigger updateLoc\n")),(0,r.mdx)("p",null,"And, just as with packages and actions, you can list the triggers you","’","ve created:"),(0,r.mdx)("p",null,(0,r.mdx)("inlineCode",{parentName:"p"},"wsk trigger list")),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre"},"triggers\n/yourNamespace/updateLoc                                              private\n")),(0,r.mdx)("p",null,"That was simple; but then, all you","’","ve really done here is create a label for a channel through which events can be passed to the system. You can fire this trigger just as simply, specifying the parameters:"),(0,r.mdx)("p",null,(0,r.mdx)("inlineCode",{parentName:"p"},"wsk trigger fire updateLoc --param name Jocasta latitude 38.316667 longitude 23.316667")),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre"},"ok: triggered updateLoc with id 94dddb5ef8ca46e9ba4648eeb9bda80f\n")),(0,r.mdx)("p",null,"So, the trigger has been fired","—","but nothing happened. You haven","’","t set up a rule yet to link this trigger with an action. Triggers that fire with no associated rule have no effect."),(0,r.mdx)("h2",{id:"creating-and-using-rules"},"Creating and using rules"),(0,r.mdx)("p",null,"To link your trigger with an action, you need to create a rule. To do so, you need the name of your trigger, the name of the action you","’","re going to execute when the trigger is fired, and a name for your rule itself. "),(0,r.mdx)("p",null,"To give your trigger an appropriate action, create an action named ",(0,r.mdx)("inlineCode",{parentName:"p"},"helloLoc")," using the following code. (See ",(0,r.mdx)("a",{parentName:"p",href:"../gettingstarted/deploy.md",title:"Deploying your first function"},"Deploying your first Adobe I/O Runtime function")," for instructions on creating an action):"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-js"},"function main(params) {\n   return {payload:  'Hello, ' + params.name + ', I see you are at latitude ' + params.latitude ', longitude ' + params.longitude };\n}\n")),(0,r.mdx)("p",null,"Now you can create the rule linking the trigger to the action:"),(0,r.mdx)("p",null,(0,r.mdx)("inlineCode",{parentName:"p"},"wsk rule create greetLoc updateLoc helloLoc")),(0,r.mdx)("p",null,"This creates a rule named ",(0,r.mdx)("inlineCode",{parentName:"p"},"greetLoc")," that executes ",(0,r.mdx)("inlineCode",{parentName:"p"},"helloLoc")," every time the trigger ",(0,r.mdx)("inlineCode",{parentName:"p"},"updateLoc")," is fired. Now, fire the trigger again:"),(0,r.mdx)("p",null,(0,r.mdx)("inlineCode",{parentName:"p"},"wsk trigger fire updateLoc --param name Jocasta latitude 38.316667 longitude 23.316667")),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre"},"ok: triggered updateLoc with id 00e0dd4cce3f43768dabb99d67731b50\n")),(0,r.mdx)("p",null,"To see what happened as a result, you can check your activations. You can list them easily:"),(0,r.mdx)("p",null,(0,r.mdx)("inlineCode",{parentName:"p"},"wsk activation list")),(0,r.mdx)("p",null,"Your ",(0,r.mdx)("inlineCode",{parentName:"p"},"hello")," action should be first on the list. If the list is long, though, you may want to just show the most recent activation:"),(0,r.mdx)("p",null,(0,r.mdx)("inlineCode",{parentName:"p"},"wsk activation list --limit 1 helloLoc")),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre"},"activations\na48069e1da3c4aa9bc48ac979c5ee140             helloLoc\n")),(0,r.mdx)("p",null,"To see the results of this activation:"),(0,r.mdx)("p",null,(0,r.mdx)("inlineCode",{parentName:"p"},"wsk activation result a48069e1da3c4aa9bc48ac979c5ee140")),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre"},'{\n    payload: "Hello, Jocasta, I see you are at latitude 38.316667, longitude 23.316667"\n}\n')),(0,r.mdx)("p",null,"So, the helloLoc action received the parameters from updateLoc and returned the result you","’","d expect."),(0,r.mdx)("p",null,"Finally, to stop a rule, you can disable it:"),(0,r.mdx)("p",null,"`wsk rule disable greetLoc"),(0,r.mdx)("h2",{id:"rules-on-triggers-and-rules"},"Rules on triggers and rules"),(0,r.mdx)("p",null,"Triggers, rules and actions can be combined in different ways: you can associate a trigger with multiple actions by using a different rule for each action, and an action can be the target of multiple triggers, again by creating a rule for each trigger. You cannot, however, link a trigger to more than one action with a single rule, nor can you link more than one trigger to an action with a single rule."),(0,r.mdx)("p",null,"Triggers and rules stand outside packages; you cannot place either in a package. You can, however, create a rule that addresses an action in a package. Suppose the ",(0,r.mdx)("inlineCode",{parentName:"p"},"helloLoc")," action is in a package named ",(0,r.mdx)("inlineCode",{parentName:"p"},"manageLoc"),":"),(0,r.mdx)("p",null,(0,r.mdx)("inlineCode",{parentName:"p"},"wsk rule create greetLoc updateLoc /manageLoc/helloLoc")),(0,r.mdx)("p",null,"`"))}u.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-guides-reference-triggersrules-md-ba58c9367f803d429218.js.map